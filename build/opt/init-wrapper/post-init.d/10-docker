#! /bin/sh

set -ex

if [ -f /usr/bin/dockerd ]; then
  exit 0
fi

if [ $(cat /etc/timezone) = "Asia/Shanghai" ]; then
  sed -i 's@download.docker.com@mirrors.ustc.edu.cn/docker-ce@g' /etc/apt/sources.list.d/docker.list
  curl -fsSL "https://mirrors.ustc.edu.cn/docker-ce/linux/debian/gpg" -o /etc/apt/keyrings/docker.asc
  apt-get -qq update >/dev/null
fi

apt-get install --no-install-recommends -y docker-ce
docker version
